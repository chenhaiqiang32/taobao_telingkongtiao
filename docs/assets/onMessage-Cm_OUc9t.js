const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./weather-WPCrQNZp.js","./main-BZSNb4nj.js","./main-CFrdjDHn.css","./dataProgress-EvRjAOi8.js"])))=>i.map(i=>d[i]);
import{_ as __vitePreload}from"./main-BZSNb4nj.js";import"./weather-WPCrQNZp.js";const TransformMap={sunny:"SUNNY",rain:"RAIN",snow:"SNOW",day:"DAY",night:"NIGHT",science:"SCIENCE"},onMessage=async()=>{const[{SUNNY,RAIN,SNOW,DAY,NIGHT,SCIENCE},{doFenceData,equipData,inspectionData,personDangerData,gatherDangerDate,sceneChange,searchData,realTimeData,dangerHistoryData}]=await Promise.all([__vitePreload(()=>import("./weather-WPCrQNZp.js").then(a=>a.bK),__vite__mapDeps([0,1,2]),import.meta.url),__vitePreload(()=>import("./dataProgress-EvRjAOi8.js"),__vite__mapDeps([3,0,1,2]),import.meta.url)]);Object.keys(TransformMap).forEach(key=>{TransformMap[key]=eval(TransformMap[key])});const waitForStore3D=()=>new Promise(a=>{const s=()=>{window.Core?a(window.Core):setTimeout(s,100)};s()}),core=await waitForStore3D();let changeSceneTimeout=null,lastChangeSceneParam=null,lastChangeSceneTime=0,isChangingScene=!1;window.addEventListener("message",a=>{if(!core){console.warn("Store3D 实例尚未初始化");return}if(a.data&&a.data.cmd)switch(a.data.cmd){case"changeLighting":{const e=TransformMap[a.data.param];if(!e){console.warn("无效的光照参数:",a.data.param);return}core.changeLighting(e);break}case"changeWeather":{const e=a.data.param;if(!e||!e.type){console.warn("无效的天气参数:",e);return}core.ground.switchWeather({type:e.type,level:e.level});break}case"close":{core._stopRender();break}case"open":{core._beginRender();break}case"setCameraState":{core.setCameraState(a.data.param);break}case"changeSystem":{core.changeSystem(a.data.param);break}case"changeScene":{const e=a.data.param,r=Date.now();if(isChangingScene){console.log("正在切换场景，忽略重复请求:",e);return}if(changeSceneTimeout&&clearTimeout(changeSceneTimeout),lastChangeSceneParam===e&&r-(lastChangeSceneTime||0)<1e3){console.log("忽略重复的场景切换请求:",e);return}lastChangeSceneParam=e,lastChangeSceneTime=r,isChangingScene=!0,changeSceneTimeout=setTimeout(()=>{console.log("执行场景切换:",e),e==="地面"?core.changeSystem("ground"):core.changeSystem("indoorSubsystem",e),setTimeout(()=>{isChangingScene=!1},500)},200);break}case"setWanderState":{a.data.param?core.beginWander():core.endWander();break}case"startMeasuring":{core.startMeasuring();break}case"removeMeasuring":{core.removeMeasuring();break}case"startMeasureArea":{core.startMeasureArea();break}case"removeMeasureArea":{core.removeMeasureArea();break}case"setHeatmap":{core.setHeatmap(a.data.param);break}case"init":{core.orientation.init(a.data.param);let e=core.orientation.followId;e&&core.followCheck(a,e);break}case"getInspectin":{let e=inspectionData(a.data.param);core.search(e);break}case"removeInset":{core.clearEquipType(a.data.param);break}case"getCameraList":{const{data:e}=a.data.param;let r=equipData(e);core.processingEquipment(r,"camera");break}case"inspectionSystem_initialData":let s=equipData(a.data.param);core.processingEquipment(s,"inspectionSystem");break;case"hideInspectionSystemIcon":core.hideInspectionSystemIcon(a.data.param);case"getBeaconList":{const{data:e}=a.data.param;let r=equipData(e);core.processingEquipment(r,"beacon");break}case"trackInit":case"trackStart":case"trackStop":case"trackSpeedUp":case"trackSpeedDown":case"trackProgress":case"trackAngleSwitch":case"trackClear":{core.historyTrackCommand(a.data);break}case"buildingNumber":{let e=a.data.param;core.changeBuildingNum(e);break}case"buildingList":{a.data.param;break}case"cherryPick":{core.cherryPick(a.data.param);break}case"startSelect":{core.changeBoxSelect(a.data.param);break}case"reSelect":{core.reSelect();break}case"fenceList":{a.data.param.data.map(e=>{const{id:r,name:i,type:l}=e;let d={fenceData:doFenceData(e),id:r,name:i,type:"area"};core.createFence(d)});break}case"resetCamera":{console.log("执行重置视角功能"),core.resetCamera();break}case"autoRoute":{const e=a.data.param;console.log(`收到自转控制命令: ${e?"开启":"关闭"}`),core.setAutoRotate(e);break}case"startSearch":{let e=searchData(a.data.param);core.search(e);break}case"closeDialog":{core.isIndoorModel()&&(core.hideBuildingDialog(),core.setIndoorModel(!1));let e=a.data.param;core.ground.boxSelectStatus||core.bindGroundEvent(),core.clearSelected(e);break}case"personFollow":const{id:o,sceneType:n,originId:c}=a.data.param;let t=sceneChange({sceneType:n,originId:c});core.startFollow({id:o,originId:c,sceneType:n,sceneChangeType:t});break;case"removePersonFollow":{core.bindSearchEvent(),core.cancelFollow();break}case"changeBuildingFloor":{core.changeFloor(a.data.param);break}case"changeIndoor":{core.changeIndoor(a.data.param);break}case"goBack":{core.changeSystem("ground");break}case"removeAllPerson":{core.clearAllPerson();break}case"personDanger":{let e=personDangerData(a.data.param);core.search(e);break}case"areaDanger":{const{fenceData:e,id:r,name:i,type:l,originId:u,sceneType:d}=a.data.param;let m={fenceData:doFenceData(a.data.param),id:r,name:i,type:"danger"};core.dangerFenceInit(m);break}case"clearDanger":{core.clearDanger();break}case"closeBuildingDialog":{let e=a.data.param;core.bindGroundEvent(),core.hideBuildingDialog(e);break}case"closeCameraDialog":{core.isIndoorModel()&&(core.hideBuildingDialog(),core.setIndoorModel(!1));let e=a.data.param;core.bindGroundEvent(),core.hideCameraDialog(e);break}case"hideCameraIcon":{core.hideCameraById(a.data.param);break}case"mouseEventSwitch":core.changeMouseEventSwitch(a.data.param);break;case"switchGather":{core.switchGatherStatus(a.data.param);break}case"setGatherLevel":{core.setGatherLevel(a.data.param);break}case"roamEnabled":{core.roamEnabled(a.data.param);break}case"roamDuration":{core.roamDuration(a.data.param);break}case"gatherDanger":{let e=gatherDangerDate(a.data.param);core.gatherWarning.gatherDanger(e);break}case"gatherNow":{let e=realTimeData(a.data.param);core.gatherWarning.realTimeGather(e);break}case"clearGatherDanger":{core.gatherWarning.disposeGather();break}case"factoryChange":{let e=core.currentSystem.clearBuildingFence?core.currentSystem.clearBuildingFence.bind(core.currentSystem):null;e&&e();const r=doFenceData(a.data.param[0]),{id:i,name:l,type:u}=a.data.param[0];let d={fenceData:r,id:i,name:l,type:"building"};core.createFence(d);break}case"gatherOrSilentArea":{a.data.param.forEach(e=>{e.areaDataOut.push(e.areaDataOut[0]),core.ground.gatherOrSilentPlate.create(e),e.areaType===3&&core.indoorSubsystem.setFloorGatherOrSilent(e)});break}case"clearGatherOrSilentArea":{core.ground.gatherOrSilentPlate.dispose(),core.indoorSubsystem.disposeGatherOrSilent();break}case"escapeRoute":{core.ground.escapeRoute.init(a.data.param);break}case"clearEscapeRoute":{core.ground.escapeRoute.dispose();break}case"meetingPoint":{a.data.param.forEach((e,r)=>{core.ground.meetingPoint.create({id:r,name:String(r),position:e})});break}case"webUpdateModel":{core.indoorSubsystem&&core.indoorSubsystem.updateDeviceLabels(a.data.param);break}case"clearDeviceLabels":{if(core.indoorSubsystem){const e=a.data.param&&a.data.param.deviceCodes;core.indoorSubsystem.clearDeviceLabelsAndInstance(e)}break}case"checkStorageStatus":{core.indoorSubsystem&&(console.log("=== 存储状态检查 ==="),console.log("当前楼层:",core.indoorSubsystem.currentFloor?core.indoorSubsystem.currentFloor.name:"null"),console.log("存储的数据:",core.indoorSubsystem.deviceLabelsData),console.log("设备标签数量:",core.indoorSubsystem.deviceLabels?core.indoorSubsystem.deviceLabels.length:0),console.log("=================="));break}case"handleDeviceClick":{const e=a.data.param;if(!e){console.warn("设备点击指令缺少设备名称参数");return}console.log(`收到设备点击指令，设备名称: ${e}`),core.indoorSubsystem?core.indoorSubsystem.handleDeviceClick(e).catch(r=>{console.error("处理设备点击时发生错误:",r)}):console.warn("室内子系统未初始化，无法处理设备点击");break}case"updateDesign":{const e=a.data.param;if(!Array.isArray(e)){console.warn("updateDesign 参数格式错误，应为数组");return}console.log("收到更新设计指令:",e),core.indoorSubsystem&&core.indoorSubsystem.updateDesign(e),core.ground&&core.ground.updateDesign(e);break}case"updateModel":{const e=a.data.param;if(!Array.isArray(e)){console.warn("updateModel 参数格式错误，应为数组");return}console.log("收到更新模型指令:",e),core.indoorSubsystem&&core.indoorSubsystem.updateModelStatus(e),core.ground&&core.ground.updateModelStatus(e);break}}}),setTimeout(()=>{const a={"测试1: comp06 开启":[{code:"comp06",name:"室外侧1#压缩机",status:1,attribute:[{key:"室外侧1#压缩机电流",value:"15.5A"},{key:"室外侧1#压缩机功率",value:"3500W"},{key:"室外侧1#压缩机吸气温度",value:"25.5℃"},{key:"室外侧1#压缩机吸气压力",value:"450KPA"},{key:"室外侧1#压缩机吸气SAT",value:"29.16℃"},{key:"室外侧1#压缩机排气温度",value:"65.2℃"},{key:"室外侧1#压缩机排气压力",value:"1800KPA"},{key:"制冷剂泄露",value:"否"}]}],"测试2: comp06 关闭":[{code:"comp06",name:"室外侧1#压缩机",status:2,attribute:[{key:"室外侧1#压缩机电流",value:"0A"},{key:"室外侧1#压缩机功率",value:"0W"},{key:"室外侧1#压缩机状态",value:"已关闭"}]}],"测试3: 多个设备开启":[{code:"comp06",name:"室外侧1#压缩机",status:1,attribute:[{key:"电流",value:"15.5A"},{key:"功率",value:"3500W"}]},{code:"comp07",name:"室外侧2#压缩机",status:1,attribute:[{key:"电流",value:"16.2A"},{key:"功率",value:"3600W"}]}],"测试4: 多个设备关闭":[{code:"comp06",name:"室外侧1#压缩机",status:2,attribute:[{key:"状态",value:"已关闭"}]},{code:"comp07",name:"室外侧2#压缩机",status:2,attribute:[{key:"状态",value:"已关闭"}]}]},s=(t,e)=>{if(!core){console.warn("Core 未初始化，无法执行测试");return}console.log(`=== 执行测试: ${e} ===`),console.log("测试数据:",t),core.indoorSubsystem&&core.indoorSubsystem.updateModelStatus(t),core.ground&&core.ground.updateModelStatus(t),console.log(`=== ${e} 测试完成 ===`)},o=document.createElement("div");o.id="updateModelTestPanel",o.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.8);
      border: 2px solid #00ced1;
      border-radius: 8px;
      padding: 15px;
      z-index: 10000;
      font-family: Arial, sans-serif;
      min-width: 200px;
    `;const n=document.createElement("div");n.textContent="updateModel 测试面板",n.style.cssText=`
      color: #00ced1;
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 10px;
      text-align: center;
    `,o.appendChild(n),Object.keys(a).forEach(t=>{const e=document.createElement("button");e.textContent=t,e.style.cssText=`
        display: block;
        width: 100%;
        margin: 5px 0;
        padding: 8px 12px;
        background: #1a1a2e;
        color: #00ced1;
        border: 1px solid #00ced1;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        transition: all 0.3s;
      `,e.addEventListener("mouseenter",()=>{e.style.background="#00ced1",e.style.color="#000"}),e.addEventListener("mouseleave",()=>{e.style.background="#1a1a2e",e.style.color="#00ced1"}),e.addEventListener("click",()=>{s(a[t],t),e.style.background="#90ee90",e.style.color="#000",setTimeout(()=>{e.style.background="#1a1a2e",e.style.color="#00ced1"},300)}),o.appendChild(e)});const c=document.createElement("button");c.textContent="关闭面板",c.style.cssText=`
      display: block;
      width: 100%;
      margin-top: 10px;
      padding: 6px 12px;
      background: #8b0000;
      color: #fff;
      border: 1px solid #8b0000;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    `,c.addEventListener("click",()=>{o.remove()}),o.appendChild(c),document.body.appendChild(o),console.log("=== updateModel 测试面板已创建 ===")},3e3)};export{onMessage};
